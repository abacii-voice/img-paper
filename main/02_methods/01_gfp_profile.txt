1. Coordinate systems

Images were grouped according to frame and channel. Images of the same frame and the same channel could be organised into a 3D block of pixels with X, Y and Z coordinates. 3D smoothing and noise-reduction could then be applied to this structure. Each column of pixels, or a single line of pixels with a fixed XY coordinate and the full range of Z coordinates, could be used to build up an intensity distribution in Z. This is known in this study as a "profile". The GFP channel provides 3D data since levels can be optically separated from each other [[[ref]]]. High intensity at a certain Z level indicates the presence of an object at that location in the original environment. Typically, the profile will have a low value when passing through the background, and a high value when passing through an object. This leads to a peak near the centre of an object. The location of the peak in Z and other properties of the distribution can allow pixels from the brightfield that show clear edges to be selected and compiled into a useful image.

2. The GFP profile

Figure [[[fig]]] shows an example of a profile for a single pixel. The profile can be generated using two parameters; namely, the amount of gaussian smoothing applied to the image to reduce noise, [[[sigma]]], and the radius of the column in XY around the position of the profile, [[[r]]]. Both of these parameters can be adjusted to affect the output. A discussion of their optimum ranges in given in Section [[[section]]]. They both define forms of smoothing. [[[sigma]]] is the radius of the 3D gaussian kernel. [[[r]]] is the radius of a linear smoothing filter in XY. The distribution is then generated using the algorithm shown in Equation [[[eq]]]. The purpose of such a profile is not to locate objects. The assumption is that high resolution GFP indicates the presence of marked cell tissue. The value [[[sigma]]] was chosen to lie between 3-5 pixels to reduce noise while not completely breaking down fine image features approximately 2-3 pixels in size. A value of between 2-3 pixels was chosen for [[[r]]] to ensure that neighbouring pixels had a smooth transition between their Z levels. This would make continuous objects such as cells that are likely to lie around a single Z level easier to recognise as a whole.

3. [[[zMod]]] and [[[zBF]]]

Once the profile has been generated, several properties can be used to aide segmentation. Firstly, the Z position of the maximum value in the distribution represents the centre of the object containing GFP, at least at the location of that particular column. Secondly, the variance of the distribution can show how bright the GFP becomes with respect to the surrounding background. This is often more useful than absolute intensity since its value is based on the presence of a relatively large peak. This can better highlight parts of the cell whose brightness might be lower than average, but still contain an intensity peak. The values can be obtained in a parallel manner as follows:

[[[parallelisation using numpy]]]

If the algorithm is applied to each XY location in the image, new images can be created using the values of interest such as the Z location and the variance. The image generated using the value of the Z location for each pixel is known here as [[[zMod]]]. It is a height map across the 3D environment. It does not contain enough information for segmentation, but it can be combined with the brightfield data to yield a new image, [[[zBF]]]. The brightfield does not contain intrinsic 3D data, but the sharpness of features in the image is best around a single Z location. This is the location of the object, and consequently, the location specified by [[[zMod]]]. Hence, each value in [[[zMod]]] can be used to select a brightfield value from the 3D stack of brightfield images and place it into the corresponding location in [[[zBF]]]. The result is a single 2D brightfield image containing features from all parts of the environment that are sharp and in-focus, regardless of their original Z location.
